spring:
  application:
    name: trading-api
  mvc:
    problemdetails:
      enabled: true
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/trading}
    username: ${SPRING_DATASOURCE_USERNAME:trading}
    password: ${SPRING_DATASOURCE_PASSWORD:trading_pass}
    driver-class-name: org.postgresql.Driver
  flyway:
    enabled: true
    locations: classpath:db/migration
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: ${OAUTH2_JWK_SET_URI:http://localhost:8080/realms/trading/protocol/openid-connect/certs}

server:
  port: ${SERVER_PORT:8081}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${APP_ENVIRONMENT:local}
  tracing:
    enabled: ${TRACING_ENABLED:true}
    sampling:
      probability: ${TRACING_SAMPLING_PROBABILITY:1.0}

springdoc:
  show-actuator: true

idempotency:
  enabled: ${IDEMPOTENCY_ENABLED:true}
  required-header: ${IDEMPOTENCY_REQUIRED_HEADER:Idempotency-Key}
  ttl-hours: ${IDEMPOTENCY_TTL_HOURS:24}
  opt-in-paths:
    - /v1/orders/**

rate-limit:
  enabled: ${RATE_LIMIT_ENABLED:false}
  max-requests: ${RATE_LIMIT_MAX_REQUESTS:50}
  window-seconds: ${RATE_LIMIT_WINDOW_SECONDS:60}
  opt-in-paths:
    - /v1/orders/**

reconciliation:
  balance:
    enabled: ${RECONCILIATION_BALANCE_ENABLED:false}
    fixed-delay-ms: ${RECONCILIATION_BALANCE_FIXED_DELAY_MS:300000}

connector:
  health:
    stale-threshold-minutes: ${CONNECTOR_HEALTH_STALE_THRESHOLD_MINUTES:5}
