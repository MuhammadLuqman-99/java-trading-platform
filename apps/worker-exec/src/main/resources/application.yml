spring:
  application:
    name: worker-exec
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/trading}
    username: ${SPRING_DATASOURCE_USERNAME:trading}
    password: ${SPRING_DATASOURCE_PASSWORD:trading_pass}
    driver-class-name: org.postgresql.Driver
  flyway:
    enabled: true
    locations: classpath:db/migration

server:
  port: ${SERVER_PORT:8082}

management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  endpoint:
    health:
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
  metrics:
    tags:
      application: ${spring.application.name}
      environment: ${APP_ENVIRONMENT:local}
  tracing:
    enabled: ${TRACING_ENABLED:true}
    sampling:
      probability: ${TRACING_SAMPLING_PROBABILITY:1.0}

infra:
  kafka:
    consumer:
      group-id: cg-exec-adapter
      auto-offset-reset: earliest
      concurrency: 1
    producer:
      client-id: worker-exec
      idempotence-enabled: true
    retry:
      mode: fixed
      max-attempts: 2
      fixed-backoff-ms: 100
    dead-letter:
      enabled: ${INFRA_KAFKA_DEAD_LETTER_ENABLED:true}
      mode: ${INFRA_KAFKA_DEAD_LETTER_MODE:topic}
      topic-suffix: ${INFRA_KAFKA_DEAD_LETTER_TOPIC_SUFFIX:.dlq.v1}
      include-payload: ${INFRA_KAFKA_DEAD_LETTER_INCLUDE_PAYLOAD:true}
    topics:
      enabled: ${INFRA_KAFKA_TOPICS_ENABLED:true}
      partitions: ${INFRA_KAFKA_TOPICS_PARTITIONS:3}
      replication-factor: ${INFRA_KAFKA_TOPICS_REPLICATION_FACTOR:1}

outbox:
  publisher:
    enabled: ${OUTBOX_PUBLISHER_ENABLED:true}
    batch-size: ${OUTBOX_PUBLISHER_BATCH_SIZE:100}
    fixed-delay-ms: ${OUTBOX_PUBLISHER_FIXED_DELAY_MS:1000}
    producer-name: ${OUTBOX_PUBLISHER_PRODUCER_NAME:worker-exec-outbox-publisher}
